---
title: "16S intern-kontroll logg"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
    html_document:
        toc: true
params:
    COUNT_DATA: "/usr/local/src/data/emu-combined-species-counts.tsv"
    #COUNT_DATA: "../data/emu-combined-species-counts.tsv"
---

```{r dependencies, include = FALSE}
library(vegan)
source("/usr/local/src/rscripts/ordiellipse_custom_scale.R")
#source("ordiellipse_custom_scale.R")
environment(ordiellipse_custom_scale) = asNamespace('vegan')
```

```{r Read parameters, include = FALSE}
COUNT_DATA = params$COUNT_DATA
```

## Prover
```{r data, echo=FALSE}
count_table = read.csv(COUNT_DATA, header=TRUE, sep="\t")
row.names(count_table)=count_table$species
count_table = count_table[,8:ncol(count_table)]
count_table[is.na(count_table)] = 0

# Factors
factors = as.data.frame(names(count_table))
row.names(factors) = factors$`names(count_tables)`
factors$sample = "mock"

prop_table = prop.table(as.matrix(count_table), 2)
cat(names(count_table), sep="\n") # Print samples included

```

## PCA
```{r pca, echo=FALSE, fig.width=14}
samples.rda = rda(t(prop_table) ~ 1)

par(mfrow = c(1, 2))
{plot(samples.rda, display="sites", type="n", main="PCA positiva kontroller")
points(samples.rda, display="sites")}
{plot(samples.rda, display="sites", type="n", main="PCA positiva kontroller")
text(samples.rda, display="sites", cex=1)}
#par(mfrow = c(1, 1))

par(mfrow = c(1, 2))
{plot(samples.rda, display="sites", type="n", main="2 standardavvikelser")
points(samples.rda, display="sites")
with(factors, ordiellipse_custom_scale(samples.rda, sample, kind="sd", scale.custom=2, draw="polygon", col="skyblue", border="blue"))

plot(samples.rda, display="sites", type="n", main="3 standardavvikelser")
points(samples.rda, display="sites")
with(factors, ordiellipse_custom_scale(samples.rda, sample, kind="sd", scale.custom=3, draw="polygon", col="skyblue", border="blue"))}

{plot(samples.rda, display="sites", type="n", main="2 standardavvikelser")
text(samples.rda, display="sites")
with(factors, ordiellipse_custom_scale(samples.rda, sample, kind="sd", scale.custom=2, draw="polygon", col="skyblue", border="blue"))

plot(samples.rda, display="sites", type="n", main="3 standardavvikelser")
text(samples.rda, display="sites")
with(factors, ordiellipse_custom_scale(samples.rda, sample, kind="sd", scale.custom=3, draw="polygon", col="skyblue", border="blue"))}
par(mfrow = c(1, 1))


```

